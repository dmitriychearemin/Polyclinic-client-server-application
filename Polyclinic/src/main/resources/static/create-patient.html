<!DOCTYPE html>
<html>
<head>
  <title>Create Patient</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .back-button {
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
    }
    .form-group input {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
    }
    .form-buttons {
      margin-top: 20px;
    }
  </style>
</head>
<body>
<button class="back-button" onclick="window.history.back()">Back</button>
<h1>Create New Patient</h1>

<form id="createPatientForm">
  <div class="form-group">
    <label for="firstName">First Name *</label>
    <input type="text" id="firstName" required>
  </div>
  <div class="form-group">
    <label for="lastName">Last Name *</label>
    <input type="text" id="lastName" required>
  </div>
  <div class="form-group">
    <label for="birthDate">Birth Date *</label>
    <input type="date" id="birthDate" required>
  </div>
  <div class="form-group">
    <label for="phone">Phone *</label>
    <input type="tel" id="phone" required>
  </div>
  <div class="form-group">
    <label for="email">Email</label>
    <input type="email" id="email">
  </div>
  <div class="form-group">
    <label for="gender">Gender</label>
    <input type="gender" id="gender">
  </div>
  <div class="form-group">
    <label for="departmentId">Department ID *</label>
    <input type="number" id="departmentId" required min="1">
  </div>
  <div class="form-buttons">
    <button type="button" onclick="createPatient()">Create Patient</button>
  </div>
</form>

<script>
  function createPatient() {
   const patientDTO = {
     firstName: document.getElementById('firstName').value.trim(),
     lastName: document.getElementById('lastName').value.trim(),
     birthDate: document.getElementById('birthDate').value,
     phone: document.getElementById('phone').value.trim(),
     email: document.getElementById('email').value.trim(),
     gender: document.getElementById('gender').value.trim(),
     departmentId: document.getElementById('departmentId').value
   };

   if (!patientDTO.firstName || !patientDTO.lastName ||
       !patientDTO.birthDate || !patientDTO.phone || !patientDTO.departmentId) {
     alert('Please fill all required fields (*)');
     return;
   }

   const button = document.querySelector('#createPatientForm button');
   button.disabled = true;
   button.innerHTML = 'Creating...';

   fetch('/api/patients', {
     method: 'POST',
     headers: {
       'Content-Type': 'application/json',
     },
     body: JSON.stringify(patientDTO),
   })
   .then(async response => {
     const data = await response.json();
     if (!response.ok) {
       const errors = data.errors ? data.errors.join('\n') : data.message;
       throw new Error(errors || 'Error creating patient');
     }
     alert('Patient created successfully!');
     window.location.href = 'patients.html?departmentId=' + patientDTO.departmentId;
   })
   .catch(error => {
     alert('Error: ' + error.message);
   })
   .finally(() => {
     button.disabled = false;
     button.innerHTML = 'Create Patient';
   });
 }
</script>
</body>
</html>