<!DOCTYPE html>
<html>
<head>
  <title>Create Doctor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .back-button {
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
    }
    .form-group input {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
    }
    .form-buttons {
      margin-top: 20px;
    }
  </style>
</head>
<body>
<button class="back-button" onclick="window.history.back()">Back</button>
<h1>Create New Doctor</h1>

<form id="createDoctorForm">
  <div class="form-group">
    <label for="firstName">First Name *</label>
    <input type="text" id="firstName" required>
  </div>
  <div class="form-group">
    <label for="lastName">Last Name *</label>
    <input type="text" id="lastName" required>
  </div>
  <div class="form-group">
    <label for="specialization">Specialization *</label>
    <input type="text" id="specialization" required>
  </div>
  <div class="form-group">
    <label for="departmentId">Department ID *</label>
    <input type="number" id="departmentId" required min="1">
  </div>
  <div class="form-group">
    <label for="hireDate">Hire Date *</label>
    <input type="date" id="hireDate" required>
  </div>
  <div class="form-group">
    <label for="phone">Phone *</label>
    <input type="tel" id="phone" required>
  </div>
  <div class="form-group">
    <label for="email">Email</label>
    <input type="email" id="email">
  </div>
  <div class="form-buttons">
    <button type="button" onclick="createDoctor()">Create Doctor</button>
  </div>
</form>

<script>
  function createDoctor() {
    const doctorDTO = {
      firstName: document.getElementById('firstName').value.trim(),
      lastName: document.getElementById('lastName').value.trim(),
      specialization: document.getElementById('specialization').value.trim(),
      departmentId: document.getElementById('departmentId').value,
      hireDate: document.getElementById('hireDate').value,
      phone: document.getElementById('phone').value.trim(),
      email: document.getElementById('email').value.trim()
    };

    if (!doctorDTO.firstName || !doctorDTO.lastName || !doctorDTO.specialization ||
        !doctorDTO.departmentId || !doctorDTO.hireDate || !doctorDTO.phone) {
      alert('Please fill all required fields (*)');
      return;
    }

    const button = document.querySelector('#createDoctorForm button');
    button.disabled = true;
    button.innerHTML = 'Creating...';

    fetch('/api/doctors', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(doctorDTO),
    })
    .then(async response => {
      const data = await response.json();
      if (!response.ok) {
        const errors = data.errors ? data.errors.join('\n') : data.message;
        throw new Error(errors || 'Error creating doctor');
      }
      alert('Doctor created successfully!');
      window.location.href = 'doctors.html?departmentId=' + doctorDTO.departmentId;
    })
    .catch(error => {
      alert('Error: ' + error.message);
    })
    .finally(() => {
      button.disabled = false;
      button.innerHTML = 'Create Doctor';
    });
  }
</script>
</body>
</html>